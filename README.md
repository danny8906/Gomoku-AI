# â™Ÿï¸ OmniAI äº”å­æ£‹ - Cloudflare Workers AI

ä¸€å€‹åŠŸèƒ½å®Œæ•´çš„ OmniAI äº”å­æ£‹éŠæˆ²ï¼Œé‹è¡Œåœ¨ Cloudflare Workers å¹³å°ä¸Šï¼Œæ•´åˆäº†å¤šé … AI åŠŸèƒ½ã€‚

ğŸŒ **éŠæˆ²ç¶²å€**: [https://gomoku-cf.omni-worker.workers.dev/](https://gomoku-cf.omni-worker.workers.dev/)

## âœ¨ åŠŸèƒ½ç‰¹è‰²

### ğŸ® éŠæˆ²æ¨¡å¼
- **AI å°æˆ°**: èˆ‡æ™ºèƒ½ AI å°æˆ°ï¼Œæ”¯æ´ä¸‰ç¨®é›£åº¦ç­‰ç´šï¼ˆç°¡å–®/ä¸­ç­‰/å›°é›£ï¼‰
- **ç©å®¶å°æˆ°**: é€é 4 ä½æˆ¿é–“ä»£ç¢¼èˆ‡æœ‹å‹å³æ™‚å°æˆ°

### ğŸ¤– AI åŠŸèƒ½
- **ä¸‰å±¤æ™ºèƒ½æ±ºç­–**: å¤šå±¤æ±ºç­–ç³»çµ±ï¼Œçµåˆå‘é‡è³‡æ–™åº«ã€AIåˆ†æå’Œå‚³çµ±ç®—æ³•
- **1024ç¶­å‘é‡åŒ–æ£‹è­œ**: ä½¿ç”¨é«˜ç¶­åº¦ Vectorize å„²å­˜å’Œæª¢ç´¢æ­·å²æ£‹è­œï¼Œæå‡ç›¸ä¼¼æ€§åŒ¹é…ç²¾åº¦
- **BGE-M3åµŒå…¥æ¨¡å‹**: ä½¿ç”¨æœ€æ–°çš„å¤šèªè¨€åµŒå…¥æ¨¡å‹ï¼Œç”Ÿæˆé«˜è³ªé‡1024ç¶­å‘é‡
- **AIåˆ†ææŒ‡å°**: AIåˆ†æçµæœç›´æ¥å½±éŸ¿è½å­æ±ºç­–ï¼Œå¯¦ç¾æ™ºèƒ½æ”»å®ˆåˆ¤æ–·
- **åŸºæœ¬å„ªå‹¢åˆ†æ**: ä½¿ç”¨æœ¬åœ°ç®—æ³•åˆ†æå±€é¢å„ªåŠ£å‹¢ï¼Œå¿«é€Ÿèª¿æ•´æ”»å®ˆç­–ç•¥
- **ç¶œåˆè©•åˆ†ç³»çµ±**: åŸºç¤åˆ†æ•¸ + æ­·å²å»ºè­°åŠ åˆ†(200) + AIåˆ†æåŠ åˆ†(150) + å„ªå‹¢åˆ†æåŠ åˆ†(100-300)
- **æ€§èƒ½å„ªåŒ–**: åˆ†ç´šè¶…æ™‚æ§åˆ¶ï¼Œç°¡å–®æ¨¡å¼ < 10ç§’ï¼Œå›°é›£æ¨¡å¼ < 30ç§’
- **å®¹éŒ¯è¨­è¨ˆ**: å¤šå±¤é™ç´šç­–ç•¥ï¼Œç¢ºä¿AIå§‹çµ‚èƒ½åšå‡ºåˆç†æ±ºç­–
- **AIç‹€æ…‹é¡¯ç¤º**: å³æ™‚é¡¯ç¤ºAIæ€è€ƒç‹€æ…‹å’Œæ€è€ƒç”¨æ™‚
- **æ€§èƒ½ç›£æ§**: è©³ç´°çš„åŸ·è¡Œæ™‚é–“æ—¥èªŒï¼Œä¾¿æ–¼è¨ºæ–·å’Œå„ªåŒ–
- **è‡ªæˆ‘è¨“ç·´æ©Ÿåˆ¶**: AIå¯é€²è¡Œè‡ªæˆ‘å°æˆ°å­¸ç¿’ï¼ŒæŒçºŒæå‡æ£‹åŠ›
- **è‡ªå‹•åŒ–å­¸ç¿’**: æ¯å°æ™‚è‡ªå‹•åŸ·è¡Œæˆ¿é–“æ¸…ç†ï¼Œç¶­è­·ç³»çµ±å¥åº·

### ğŸ  æˆ¿é–“ç³»çµ±
- **Durable Objects**: åŸºæ–¼ Cloudflare çš„å³æ™‚å¤šäººå°æˆ°æˆ¿é–“
- **4 ä½éš¨æ©Ÿæˆ¿é–“ä»£ç¢¼**: ç°¡å–®æ˜“è¨˜ï¼Œæ–¹ä¾¿åˆ†äº«å’ŒåŠ å…¥
- **å³æ™‚é€šè¨Š**: WebSocket æ”¯æ´èŠå¤©
- **è‡ªå‹•é‡é€£**: ç¶²è·¯æ–·ç·šè‡ªå‹•é‡é€£æ©Ÿåˆ¶

### ğŸ‘¤ ç”¨æˆ¶ç³»çµ±
- **D1 è³‡æ–™åº«**: å®‰å…¨çš„ç”¨æˆ¶å¸³è™Ÿå’Œæˆ°ç¸¾ç®¡ç†
- **ELO è©•åˆ†ç³»çµ±**: å…¬å¹³çš„æ£‹åŠ›è©•åˆ†ç®—æ³•
- **å…¨çƒæ’è¡Œæ¦œ**: å¯¦æ™‚æ›´æ–°çš„ç©å®¶æ’å
- **éŠæˆ²æ­·å²**: å®Œæ•´çš„å°å±€è¨˜éŒ„å’Œçµ±è¨ˆ
- **åŒ¿åç©å®¶**: æ”¯æ´åŒ¿åå°æˆ°ï¼Œè‡ªå‹•ç”Ÿæˆç”¨æˆ¶å

### ğŸ¨ ç”¨æˆ¶é«”é©—
- **éŸ¿æ‡‰å¼è¨­è¨ˆ**: é©é…æ¡Œé¢å’Œè¡Œå‹•è£ç½®
- **ç¾ä»£åŒ– UI**: ç°¡æ½”ç¾è§€çš„ä»‹é¢è¨­è¨ˆï¼Œç™½è‰²ä¸»é¡Œé¢¨æ ¼
- **å³æ™‚åé¥‹**: æµæš¢çš„å‹•ç•«å’Œè¦–è¦ºæ•ˆæœ
- **AIç‹€æ…‹é¢æ¿**: é¡¯ç¤ºAIæ€è€ƒç‹€æ…‹å’Œç”¨æ™‚çµ±è¨ˆ
- **ç„¡éšœç¤™æ”¯æ´**: ç¬¦åˆ Web ç„¡éšœç¤™æ¨™æº–

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### å¾Œç«¯æŠ€è¡“
- **Cloudflare Workers**: ç„¡ä¼ºæœå™¨é‹ç®—å¹³å°ï¼Œå…¨çƒé‚Šç·£è¨ˆç®—
- **TypeScript**: é¡å‹å®‰å…¨çš„é–‹ç™¼é«”é©—ï¼Œæå‡ç¨‹å¼ç¢¼å“è³ª
- **Durable Objects**: æœ‰ç‹€æ…‹çš„å³æ™‚æœå‹™ï¼Œæ”¯æ´å¤šäººå°æˆ°
- **D1 è³‡æ–™åº«**: SQLite å…¼å®¹çš„ç„¡ä¼ºæœå™¨è³‡æ–™åº«ï¼ŒæŒä¹…åŒ–å­˜å„²
- **KV å­˜å„²**: éµå€¼å°å­˜å„²æœå‹™ï¼Œç”¨æ–¼ç®¡ç†å“¡é…ç½®å’Œå¿«å–
- **Vectorize**: å‘é‡è³‡æ–™åº«æœå‹™ï¼ŒAI ç›¸ä¼¼åº¦æª¢ç´¢
- **Workers AI**: å…§å»º AI æ¨¡å‹æœå‹™ï¼Œæ™ºèƒ½å°æˆ°å¼•æ“
- **éœæ…‹è³‡æº**: è‡ªå‹• CDN åˆ†ç™¼ï¼Œå…¨çƒåŠ é€Ÿ

### å‰ç«¯æŠ€è¡“
- **åŸç”Ÿ JavaScript**: ç„¡æ¡†æ¶ä¾è³´ï¼Œè¼•é‡ç´šå¯¦ç¾
- **Canvas API**: é«˜æ€§èƒ½æ£‹ç›¤ç¹ªè£½ï¼Œæµæš¢å‹•ç•«
- **WebSocket**: å³æ™‚é€šè¨Šï¼Œä½å»¶é²å°æˆ°
- **ç¾ä»£ CSS**: éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œé©é…å„ç¨®è£ç½®
- **HTML5**: èªç¾©åŒ–æ¨™è¨˜ï¼Œç„¡éšœç¤™æ”¯æ´

### é–‹ç™¼å·¥å…·
- **Wrangler CLI**: Cloudflare é–‹ç™¼å’Œéƒ¨ç½²å·¥å…·
- **ESLint**: ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥
- **Prettier**: ç¨‹å¼ç¢¼æ ¼å¼åŒ–
- **Git**: ç‰ˆæœ¬æ§åˆ¶

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚
- Node.js 18+
- Cloudflare å¸³è™Ÿ
- Wrangler CLI

### å®‰è£æ­¥é©Ÿ

1. **å…‹éš†å°ˆæ¡ˆ**
   ```bash
   git clone <repository-url>
   cd gomoku-cf
   ```

2. **å®‰è£ä¾è³´**
   ```bash
   npm install
   ```

3. **ç™»å…¥ Cloudflare**
   ```bash
   wrangler login
   ```

4. **æ‰‹å‹•éƒ¨ç½²**

åŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿé€²è¡Œéƒ¨ç½²ï¼š

1. **å‰µå»º D1 è³‡æ–™åº«**
   ```bash
   wrangler d1 create gomoku-db
   ```

2. **å‰µå»º KV å‘½åç©ºé–“**
   ```bash
   wrangler kv:namespace create "gomoku_admin"
   ```

3. **æ›´æ–° wrangler.toml**
   å°‡ç”Ÿæˆçš„ database_id å’Œ kv namespace id å¡«å…¥ wrangler.toml æ–‡ä»¶ä¸­

4. **åŸ·è¡Œè³‡æ–™åº«é·ç§»**
   ```bash
   wrangler d1 migrations apply gomoku-db --remote
   ```

5. **å‰µå»º Vectorize ç´¢å¼•**
   ```bash
   wrangler vectorize create gomoku-games --dimensions=1024 --metric=cosine
   ```

6. **éƒ¨ç½² Worker**
   ```bash
   wrangler deploy
   ```

## ğŸ“š API æ–‡æª”

### ğŸ® éŠæˆ² API (`/api/game`)

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `POST` | `/api/game/create` | å‰µå»ºæ–°éŠæˆ² | âŒ |
| `POST` | `/api/game/move` | åŸ·è¡Œè½å­ | âŒ |
| `POST` | `/api/game/ai-move` | AI è½å­ | âŒ |
| `GET` | `/api/game/state/:id` | ç²å–éŠæˆ²ç‹€æ…‹ | âŒ |

**è«‹æ±‚ç¯„ä¾‹ï¼š**
```json
// POST /api/game/create
{
  "mode": "ai" | "pvp",
  "userId": "string"
}

// POST /api/game/move
{
  "gameId": "string",
  "position": { "row": number, "col": number },
  "player": "black" | "white"
}

// POST /api/game/ai-move
{
  "gameId": "string",
  "difficulty": "easy" | "medium" | "hard"
}

// å›æ‡‰ç¯„ä¾‹
{
  "gameState": { ... },
  "aiMove": {
    "position": { "row": 7, "col": 7 },
    "reasoning": "åœ¨ (7, 7) è½å­",
    "confidence": 0.85,
    "thinkingTime": 3250
  }
}
```

### ğŸ‘¤ ç”¨æˆ¶ API (`/api/user`)

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `POST` | `/api/user/register` | ç”¨æˆ¶è¨»å†Š | âŒ |
| `POST` | `/api/user/login` | ç”¨æˆ¶ç™»å…¥ | âŒ |
| `POST` | `/api/user/change-password` | æ›´æ”¹å¯†ç¢¼ | âœ… |
| `GET` | `/api/user/profile/:id` | ç²å–ç”¨æˆ¶è³‡æ–™ | âŒ |
| `GET` | `/api/user/leaderboard` | ç²å–æ’è¡Œæ¦œ | âŒ |
| `GET` | `/api/user/history/:id` | ç²å–éŠæˆ²æ­·å² | âŒ |
| `GET` | `/api/user/stats/:id` | ç²å–ç”¨æˆ¶çµ±è¨ˆ | âŒ |
| `GET` | `/api/user/search` | æœç´¢ç”¨æˆ¶ | âŒ |
| `GET` | `/api/user/me` | ç²å–ç•¶å‰ç”¨æˆ¶ | âœ… |

**è«‹æ±‚ç¯„ä¾‹ï¼š**
```json
// POST /api/user/register
{
  "username": "string",
  "email": "string?",
  "password": "string?"
}

// POST /api/user/login
{
  "username": "string",
  "password": "string"
}

// GET /api/user/leaderboard?limit=10
// GET /api/user/search?q=username&limit=10
```

### ğŸ  æˆ¿é–“ API (`/api/room`)

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `POST` | `/api/room/create` | å‰µå»ºæˆ¿é–“ | âŒ |
| `POST` | `/api/room/join` | åŠ å…¥æˆ¿é–“ | âŒ |
| `GET` | `/api/room/:code` | ç²å–æˆ¿é–“ä¿¡æ¯ | âŒ |
| `GET` | `/api/room/:code/websocket` | WebSocket é€£æ¥ | âŒ |
| `GET` | `/api/room/:code/stats` | ç²å–æˆ¿é–“çµ±è¨ˆ | âŒ |
| `POST` | `/api/room/:code/cleanup` | æ‰‹å‹•æ¸…ç†æˆ¿é–“ | âŒ |

**è«‹æ±‚ç¯„ä¾‹ï¼š**
```json
// POST /api/room/create
{
  "mode": "pvp" | "ai",
  "userId": "string"
}

// POST /api/room/join
{
  "roomCode": "string",
  "userId": "string"
}
```

### ğŸ”§ ç®¡ç†å“¡ API (`/api/admin`)

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `GET` | `/api/admin/rooms` | ç²å–æ‰€æœ‰æˆ¿é–“ | âœ… |
| `GET` | `/api/admin/rooms/active` | ç²å–æ´»èºæˆ¿é–“ | âœ… |
| `GET` | `/api/admin/rooms/idle` | ç²å–é–’ç½®æˆ¿é–“ | âœ… |
| `GET` | `/api/admin/rooms/stats` | ç²å–æˆ¿é–“çµ±è¨ˆ | âœ… |
| `GET` | `/api/admin/rooms/:code` | ç²å–æˆ¿é–“è©³æƒ… | âœ… |
| `POST` | `/api/admin/rooms/cleanup` | æ¸…ç†æ‰€æœ‰é–’ç½®æˆ¿é–“ | âœ… |
| `POST` | `/api/admin/rooms/:code/cleanup` | æ¸…ç†ç‰¹å®šæˆ¿é–“ | âœ… |
| `POST` | `/api/admin/database/clear` | æ¸…ç©ºè³‡æ–™åº« | âœ… |
| `POST` | `/api/admin/password/set` | è¨­ç½®ç®¡ç†å“¡å¯†ç¢¼ | âœ… |

**èªè­‰æ–¹å¼ï¼š**
```
Authorization: Bearer <admin_token>
```

### ğŸ“Š éŠæˆ²è¨˜éŒ„ API (`/api/gameRecord`)

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `GET` | `/api/gameRecord/:id` | ç²å–éŠæˆ²è¨˜éŒ„ | âŒ |
| `GET` | `/api/gameRecord/user/:userId` | ç²å–ç”¨æˆ¶éŠæˆ²è¨˜éŒ„ | âŒ |
| `POST` | `/api/gameRecord/save` | ä¿å­˜éŠæˆ²è¨˜éŒ„ | âŒ |

### ğŸŒ éœæ…‹è³‡æº API

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `GET` | `/` | é¦–é  | âŒ |
| `GET` | `/game` | éŠæˆ²é é¢ | âŒ |
| `GET` | `/room` | æˆ¿é–“é é¢ | âŒ |
| `GET` | `/profile` | å€‹äººè³‡æ–™é é¢ | âŒ |
| `GET` | `/leaderboard` | æ’è¡Œæ¦œé é¢ | âŒ |
| `GET` | `/app.js` | æ‡‰ç”¨ç¨‹å¼ JavaScript | âŒ |
| `GET` | `/styles.css` | æ¨£å¼è¡¨ | âŒ |
| `GET` | `/favicon.ico` | ç¶²ç«™åœ–æ¨™ | âŒ |

### â° å®šæ™‚ä»»å‹™

| ä»»å‹™ | é »ç‡ | åŠŸèƒ½ |
|------|------|------|
| `handleHourlyCleanup` | æ¯å°æ™‚ | æ¸…ç†é–’ç½®æˆ¿é–“ï¼Œç¶­è­·ç³»çµ±å¥åº· |
| `handleDailyCleanup` | æ¯å¤© | æ·±åº¦æ¸…ç†ä»»å‹™ï¼Œå„ªåŒ–ç³»çµ±æ€§èƒ½ |

### ğŸ¤– AIè‡ªæˆ‘è¨“ç·´ API (`/api/ai-training`)

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `POST` | `/api/ai-training/start` | é–‹å§‹AIè‡ªæˆ‘è¨“ç·´ | âœ… |
| `GET` | `/api/ai-training/stats` | ç²å–è¨“ç·´çµ±è¨ˆæ•¸æ“š | âœ… |

**è«‹æ±‚ç¯„ä¾‹ï¼š**
```json
// POST /api/ai-training/start
{
  "difficulty": "easy" | "medium" | "hard"
}

// å›æ‡‰ç¯„ä¾‹
{
  "message": "AIè‡ªæˆ‘è¨“ç·´å·²é–‹å§‹",
  "difficulty": "medium",
  "status": "started",
  "timestamp": "2024-01-01T00:00:00.000Z"
}

// GET /api/ai-training/stats?sessionId=training-xxx
// å›æ‡‰ç¯„ä¾‹
{
  "stats": [
    {
      "id": "training-xxx",
      "totalGames": 20,
      "winRate": 0.65,
      "averageQuality": 0.78,
      "duration": 3600000,
      "difficulty": "medium",
      "timestamp": 1704067200000
    }
  ],
  "count": 1,
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

## ğŸ¯ éŠæˆ²è¦å‰‡

### åŸºæœ¬è¦å‰‡
- æ£‹ç›¤å¤§å°ï¼š15Ã—15
- ç²å‹æ¢ä»¶ï¼šé€£æˆ 5 å­
- é»‘æ£‹å…ˆæ‰‹

### AI é›£åº¦ç­‰ç´š
- **ç°¡å–®**: æ€è€ƒæ™‚é–“ < 10ç§’ï¼Œ30% æ©Ÿç‡é¸æ“‡æ¬¡å„ªè§£ï¼Œå¿«é€ŸéŸ¿æ‡‰
- **ä¸­ç­‰**: æ€è€ƒæ™‚é–“ < 20ç§’ï¼Œ10% æ©Ÿç‡é¸æ“‡æ¬¡å„ªè§£ï¼Œå¹³è¡¡é›£åº¦
- **å›°é›£**: æ€è€ƒæ™‚é–“ < 30ç§’ï¼Œç¸½æ˜¯é¸æ“‡æœ€å„ªè§£ï¼Œæœ€é«˜æŒ‘æˆ°

### è©•åˆ†ç³»çµ±
- æ¡ç”¨ ELO è©•åˆ†ç®—æ³•
- åˆå§‹è©•åˆ†ï¼š1200
- K å› å­ï¼š32

## ğŸ”§ é–‹ç™¼æŒ‡å—

### è³‡æ–™åº«ç®¡ç†

```bash
# å‰µå»º D1 è³‡æ–™åº«
npm run db:create

# åŸ·è¡Œè³‡æ–™åº«é·ç§»
npm run db:migrate

# å‰µå»ºæ–°é·ç§»
wrangler d1 migrations create gomoku-db <migration-name>

# åŸ·è¡Œé·ç§»ï¼ˆæœ¬åœ°ï¼‰
wrangler d1 migrations apply gomoku-db --local

# åŸ·è¡Œé·ç§»ï¼ˆé ç¨‹ï¼‰
wrangler d1 migrations apply gomoku-db --remote

# æŸ¥è©¢è³‡æ–™åº«
wrangler d1 execute gomoku-db --command="SELECT * FROM users LIMIT 10"
```

### Vectorize ç®¡ç†

```bash
# å‰µå»º Vectorize ç´¢å¼•
npm run vectorize:create

# æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯
wrangler vectorize get gomoku-games

# æ’å…¥å‘é‡æ•¸æ“š
wrangler vectorize insert gomoku-games --file=vectors.json

# æŸ¥è©¢ç›¸ä¼¼å‘é‡
wrangler vectorize query gomoku-games --vector="[0.1, 0.2, ...]"
```

### KV å­˜å„²ç®¡ç†

```bash
# å‰µå»º KV å‘½åç©ºé–“
wrangler kv:namespace create "gomoku_admin"

# åˆ—å‡ºæ‰€æœ‰ KV å‘½åç©ºé–“
wrangler kv:namespace list

# æŸ¥çœ‹ KV ä¸­çš„éµå€¼å°
wrangler kv:key list --binding=gomoku_admin

# è¨­ç½® KV å€¼
wrangler kv:key put "key" "value" --binding=gomoku_admin

# ç²å– KV å€¼
wrangler kv:key get "key" --binding=gomoku_admin

# åˆªé™¤ KV å€¼
wrangler kv:key delete "key" --binding=gomoku_admin
```

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
gomoku-cf/
â”œâ”€â”€ src/                     # åŸå§‹ç¢¼ç›®éŒ„
â”‚   â”œâ”€â”€ ai/                  # AI ç›¸é—œåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ AIEngine.ts      # AI å¼•æ“æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ VectorizeService.ts # å‘é‡åŒ–æœå‹™
â”‚   â”‚   â””â”€â”€ SelfTrainingService.ts # AIè‡ªæˆ‘è¨“ç·´æœå‹™
â”‚   â”œâ”€â”€ database/            # è³‡æ–™åº«æœå‹™
â”‚   â”‚   â”œâ”€â”€ RoomService.ts   # æˆ¿é–“è³‡æ–™ç®¡ç†
â”‚   â”‚   â””â”€â”€ UserService.ts   # ç”¨æˆ¶è³‡æ–™ç®¡ç†
â”‚   â”œâ”€â”€ durable-objects/     # Durable Objects
â”‚   â”‚   â””â”€â”€ GameRoom.ts      # éŠæˆ²æˆ¿é–“å¯¦ä¾‹
â”‚   â”œâ”€â”€ game/                # éŠæˆ²æ ¸å¿ƒé‚è¼¯
â”‚   â”‚   â””â”€â”€ GameLogic.ts     # äº”å­æ£‹éŠæˆ²è¦å‰‡
â”‚   â”œâ”€â”€ handlers/            # API è·¯ç”±è™•ç†å™¨
â”‚   â”‚   â”œâ”€â”€ admin.ts         # ç®¡ç†å“¡ API
â”‚   â”‚   â”œâ”€â”€ aiTraining.ts    # AIè‡ªæˆ‘è¨“ç·´ API
â”‚   â”‚   â”œâ”€â”€ cron.ts          # å®šæ™‚ä»»å‹™è™•ç†
â”‚   â”‚   â”œâ”€â”€ game.ts          # éŠæˆ²ç›¸é—œ API
â”‚   â”‚   â”œâ”€â”€ gameRecord.ts    # éŠæˆ²è¨˜éŒ„è™•ç†
â”‚   â”‚   â”œâ”€â”€ room.ts          # æˆ¿é–“ç®¡ç† API
â”‚   â”‚   â”œâ”€â”€ static.ts        # éœæ…‹è³‡æºæœå‹™
â”‚   â”‚   â””â”€â”€ user.ts          # ç”¨æˆ¶ç®¡ç† API
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•¸
â”‚   â”‚   â”œâ”€â”€ auth.ts          # èº«ä»½é©—è­‰å·¥å…·
â”‚   â”‚   â””â”€â”€ cors.ts          # CORS è·¨åŸŸè¨­å®š
â”‚   â”œâ”€â”€ types.ts             # TypeScript é¡å‹å®šç¾©
â”‚   â””â”€â”€ index.ts             # æ‡‰ç”¨ç¨‹å¼ä¸»å…¥å£
â”œâ”€â”€ public/                  # éœæ…‹è³‡æºç›®éŒ„
â”‚   â””â”€â”€ logo.png             # æ‡‰ç”¨ç¨‹å¼ Logo
â”œâ”€â”€ migrations/              # è³‡æ–™åº«é·ç§»æª”æ¡ˆ
â”‚   â””â”€â”€ 0001_initial.sql     # åˆå§‹è³‡æ–™åº«çµæ§‹
â”œâ”€â”€ dist/                    # ç·¨è­¯è¼¸å‡ºç›®éŒ„
â”‚   â””â”€â”€ ...                  # TypeScript ç·¨è­¯çµæœ
â”œâ”€â”€ wrangler.toml            # Cloudflare Workers é…ç½®
â”œâ”€â”€ package.json             # Node.js å°ˆæ¡ˆé…ç½®
â”œâ”€â”€ tsconfig.json            # TypeScript ç·¨è­¯é…ç½®
â”œâ”€â”€ worker-configuration.d.ts # Workers é¡å‹å®šç¾©
â”œâ”€â”€ .eslintrc.js             # ESLint é…ç½®
â”œâ”€â”€ .prettierrc              # Prettier é…ç½®
â”œâ”€â”€ .gitignore               # Git å¿½ç•¥æª”æ¡ˆ
â””â”€â”€ README.md                # å°ˆæ¡ˆèªªæ˜æ–‡æª”
```

## ğŸ§  AIæ±ºç­–æµç¨‹è©³è§£

### ğŸ”„ æ™ºèƒ½æ±ºç­–ç³»çµ±

æˆ‘å€‘çš„AIæ¡ç”¨**å¤šå±¤æ··åˆæ±ºç­–**æ¶æ§‹ï¼Œå¯¦ç¾"å…ˆæŸ¥æ­·å²ï¼Œå†AIåˆ†æï¼Œæœ€å¾Œæ™ºèƒ½æ±ºç­–"çš„é‚è¼¯ï¼š

#### **éšæ®µ1ï¼šä¸¦è¡Œæ•¸æ“šæ”¶é›†**
```
1. å‘é‡è³‡æ–™åº«æŸ¥è©¢ â†’ ç²å–æ­·å²æ£‹è­œå»ºè­°
2. AIæ·±åº¦åˆ†æ â†’ åˆ†æç•¶å‰å±€å‹¢å’Œæˆ°ç•¥
3. åŸºæœ¬å„ªå‹¢åˆ†æ â†’ æœ¬åœ°ç®—æ³•åˆ¤æ–·å±€é¢å„ªåŠ£å‹¢
```

#### **éšæ®µ2ï¼šæ™ºèƒ½è©•åˆ†ç³»çµ±**
```
æœ€çµ‚åˆ†æ•¸ = åŸºç¤åˆ†æ•¸ + æ­·å²å»ºè­°åŠ åˆ†(200) + AIåˆ†æåŠ åˆ†(150) + å„ªå‹¢åˆ†æåŠ åˆ†(100-300)
```

- **åŸºç¤åˆ†æ•¸**: å‚³çµ±äº”å­æ£‹ç®—æ³•è©•ä¼°
- **æ­·å²å»ºè­°åŠ åˆ†**: æ­·å²æ£‹è­œä¸­çš„æˆåŠŸè½å­ä½ç½® (+200åˆ†)
- **AIåˆ†æåŠ åˆ†**: æ ¹æ“šAIåˆ†æçš„æ”»å®ˆç­–ç•¥èª¿æ•´ (+150åˆ†)
- **å„ªå‹¢åˆ†æåŠ åˆ†**: æ ¹æ“šåŸºæœ¬ç®—æ³•åˆ¤æ–·çš„å±€é¢å„ªåŠ£å‹¢æ™ºèƒ½èª¿æ•´ (+100-300åˆ†)

#### **éšæ®µ3ï¼šç­–ç•¥åˆ¤æ–·**
- **é˜²å®ˆæ¨¡å¼**: AIæåˆ°"é˜²å®ˆ/å¨è„…"æ™‚ï¼Œå°é˜²å®ˆä½ç½®åŠ åˆ†
- **é€²æ”»æ¨¡å¼**: AIæåˆ°"é€²æ”»/æ©Ÿæœƒ"æ™‚ï¼Œå°é€²æ”»ä½ç½®åŠ åˆ†
- **å„ªå‹¢ç­–ç•¥**: æ ¹æ“šå±€é¢å„ªåŠ£å‹¢æ™ºèƒ½èª¿æ•´æ”»å®ˆç­–ç•¥
  - **åŠ£å‹¢å±€é¢**: å„ªå…ˆé˜²å®ˆä½ç½® (+300åˆ† Ã— ä¿¡å¿ƒåº¦)
  - **å„ªå‹¢å±€é¢**: å„ªå…ˆé€²æ”»ä½ç½® (+300åˆ† Ã— ä¿¡å¿ƒåº¦)
  - **å¹³å±€å±€é¢**: å¹³è¡¡è€ƒæ…® (+100åˆ† Ã— ä¿¡å¿ƒåº¦)

#### **éšæ®µ4ï¼šé›£åº¦åˆ†ç´š**
- **ç°¡å–®**: 30% æ©Ÿç‡é¸æ“‡æ¬¡å„ªè§£ï¼Œå¿«é€ŸéŸ¿æ‡‰
- **ä¸­ç­‰**: 10% æ©Ÿç‡é¸æ“‡æ¬¡å„ªè§£ï¼Œå¹³è¡¡é›£åº¦  
- **å›°é›£**: ç¸½æ˜¯é¸æ“‡æœ€å„ªè§£ï¼Œæœ€é«˜æŒ‘æˆ°

#### **éšæ®µ5ï¼šå®¹éŒ¯æ©Ÿåˆ¶**
```
å®Œæ•´åˆ†æ â†’ å¿«é€Ÿåˆ†æ â†’ åŸºæœ¬ç­–ç•¥
```
ç¢ºä¿AIå§‹çµ‚èƒ½åšå‡ºåˆç†æ±ºç­–

## ğŸ¤– AIè‡ªæˆ‘è¨“ç·´æ©Ÿåˆ¶

### ğŸ§  è¨“ç·´æµç¨‹

æˆ‘å€‘çš„AIå…·å‚™è‡ªæˆ‘å­¸ç¿’èƒ½åŠ›ï¼Œå¯ä»¥é€šéè‡ªæˆ‘å°æˆ°æŒçºŒæå‡æ£‹åŠ›ï¼š

#### **1. è‡ªæˆ‘å°æˆ°ç³»çµ±**
```
AI vs AI â†’ å¤šå±€å°æˆ° â†’ è³ªé‡è©•ä¼° â†’ æ•¸æ“šå­˜å„² â†’ æ£‹åŠ›æå‡
```

#### **2. è¨“ç·´åƒæ•¸**
| é›£åº¦ | å°æˆ°å±€æ•¸ | éš¨æ©Ÿå› å­ | é æœŸæ•ˆæœ |
|------|---------|----------|----------|
| **ç°¡å–®** | 10å±€ | 30% | å¿«é€ŸåŸºç¤å­¸ç¿’ |
| **ä¸­ç­‰** | 20å±€ | 10% | å¹³è¡¡å­¸ç¿’ |
| **å›°é›£** | 50å±€ | 5% | æ·±åº¦å­¸ç¿’ |

#### **3. æ™ºèƒ½è©•ä¼°**
- **ç§»å‹•è³ªé‡**: è©•ä¼°æ¯å€‹ç§»å‹•çš„è³ªé‡ï¼ˆå¥½/å£/ä¸­æ€§ï¼‰
- **å­¸ç¿’åƒ¹å€¼**: æ ¹æ“šéŠæˆ²é•·åº¦ã€çµæœã€å¤šæ¨£æ€§è©•ä¼°å­¸ç¿’åƒ¹å€¼
- **æ•¸æ“šç¯©é¸**: åªå­˜å„²æœ‰åƒ¹å€¼çš„ç§»å‹•ï¼ˆå­¸ç¿’åƒ¹å€¼ > 0.3ï¼‰

#### **4. ç­–ç•¥å­¸ç¿’**
- **é€²æ”»è©•ä¼°**: åˆ†æé€£ç·šæ½›åŠ›å’Œå‹åˆ©æ©Ÿæœƒ
- **é˜²å®ˆè©•ä¼°**: è­˜åˆ¥å°æ‰‹å¨è„…ä¸¦å„ªå…ˆé˜²å®ˆ
- **ä½ç½®åƒ¹å€¼**: ä¸­å¿ƒä½ç½®ç²å¾—æ›´é«˜è©•åˆ†
- **éš¨æ©Ÿæ€§**: æ ¹æ“šé›£åº¦æ·»åŠ é©ç•¶çš„éš¨æ©Ÿæ€§

#### **5. æŒçºŒæ”¹é€²**
- **ç¶“é©—ç©ç´¯**: é«˜è³ªé‡ç§»å‹•æœƒè¢«å­˜å„²ä¸¦åœ¨æœªä¾†åƒè€ƒ
- **ç­–ç•¥å„ªåŒ–**: é€šéå¤§é‡å°æˆ°å„ªåŒ–é€²æ”»å’Œé˜²å®ˆç­–ç•¥
- **æ•¸æ“šé©…å‹•**: åŸºæ–¼å¯¦éš›å°æˆ°æ•¸æ“šè€Œéç†è«–ç®—æ³•

### ğŸ¯ ä½¿ç”¨æ–¹æ³•

```bash
# é–‹å§‹AIè‡ªæˆ‘è¨“ç·´ï¼ˆä¸­ç­‰é›£åº¦ï¼‰
curl -X POST https://gomoku-cf.omni-worker.workers.dev/api/ai-training/start \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"difficulty": "medium"}'

# ç²å–è¨“ç·´çµ±è¨ˆ
curl -X GET https://gomoku-cf.omni-worker.workers.dev/api/ai-training/stats \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### ğŸ“Š è¨“ç·´æ•ˆæœ

- **æŒçºŒæ”¹é€²**: AIæœƒå¾æ¯æ¬¡è‡ªæˆ‘è¨“ç·´ä¸­å­¸ç¿’
- **ç¶“é©—ç©ç´¯**: é«˜è³ªé‡ç§»å‹•æœƒè¢«å­˜å„²ä¸¦åœ¨æœªä¾†åƒè€ƒ
- **ç­–ç•¥å„ªåŒ–**: é€šéå¤§é‡å°æˆ°å„ªåŒ–é€²æ”»å’Œé˜²å®ˆç­–ç•¥
- **æ•¸æ“šé©…å‹•**: åŸºæ–¼å¯¦éš›å°æˆ°æ•¸æ“šè€Œéç†è«–ç®—æ³•

## ğŸš€ æœ€æ–°åŠŸèƒ½æ›´æ–°

### AI ç³»çµ±å„ªåŒ– (v2.5)
- **ä¸‰å±¤æ™ºèƒ½æ±ºç­–**: çµåˆå‘é‡è³‡æ–™åº«ã€AIåˆ†æå’Œå‚³çµ±ç®—æ³•çš„å¤šå±¤æ±ºç­–ç³»çµ±
- **1024ç¶­å‘é‡è³‡æ–™åº«**: å‡ç´šè‡³æ›´é«˜ç¶­åº¦çš„å‘é‡ç´¢å¼•ï¼Œæå‡ç›¸ä¼¼æ€§æª¢ç´¢ç²¾åº¦
- **BGE-M3åµŒå…¥æ¨¡å‹**: ä½¿ç”¨æœ€æ–°çš„å¤šèªè¨€åµŒå…¥æ¨¡å‹ï¼Œç”Ÿæˆ1024ç¶­å‘é‡
- **AIåˆ†ææŒ‡å°**: AIåˆ†æçµæœç›´æ¥å½±éŸ¿è½å­æ±ºç­–ï¼Œå¯¦ç¾æ™ºèƒ½æ”»å®ˆåˆ¤æ–·
- **åŸºæœ¬å„ªå‹¢åˆ†æ**: ä½¿ç”¨æœ¬åœ°ç®—æ³•é€²è¡Œå±€é¢å„ªåŠ£å‹¢åˆ†æï¼Œæ™ºèƒ½èª¿æ•´æ”»å®ˆç­–ç•¥
- **æ€è€ƒæ™‚é–“å„ªåŒ–**: 
  - ç°¡å–®æ¨¡å¼ï¼š< 10ç§’ï¼ˆå¿«é€Ÿæ±ºç­–ï¼‰
  - ä¸­ç­‰æ¨¡å¼ï¼š< 20ç§’ï¼ˆå¹³è¡¡åˆ†æï¼‰
  - å›°é›£æ¨¡å¼ï¼š< 30ç§’ï¼ˆæ·±åº¦æ€è€ƒï¼‰
- **ç¶œåˆè©•åˆ†ç³»çµ±**: åŸºç¤åˆ†æ•¸ + æ­·å²å»ºè­°åŠ åˆ†(200) + AIåˆ†æåŠ åˆ†(150) + å„ªå‹¢åˆ†æåŠ åˆ†(100-300)
- **AIç‹€æ…‹é¢æ¿**: æ–°å¢AIæ€è€ƒç‹€æ…‹é¡¯ç¤ºï¼ŒåŒ…å«æ€è€ƒç”¨æ™‚çµ±è¨ˆ
- **å®¹éŒ¯æ©Ÿåˆ¶**: å¤šå±¤é™ç´šç­–ç•¥ï¼Œç¢ºä¿AIå§‹çµ‚èƒ½åšå‡ºåˆç†æ±ºç­–
- **UIæ”¹é€²**: æ¡ç”¨ç™½è‰²ä¸»é¡Œé¢¨æ ¼ï¼Œæ›´åŠ ç°¡æ½”ç¾è§€
- **æ€§èƒ½ç›£æ§**: è©³ç´°çš„AIåŸ·è¡Œæ™‚é–“æ—¥èªŒï¼Œä¾¿æ–¼è¨ºæ–·æ€§èƒ½å•é¡Œ
- **AIè‡ªæˆ‘è¨“ç·´**: æ–°å¢AIè‡ªæˆ‘å°æˆ°å­¸ç¿’æ©Ÿåˆ¶ï¼ŒæŒçºŒæå‡æ£‹åŠ›
- **è‡ªå‹•åŒ–ç¶­è­·**: æ¯å°æ™‚è‡ªå‹•æ¸…ç†é–’ç½®æˆ¿é–“ï¼Œç¶­è­·ç³»çµ±å¥åº·
- **Cronè§¸ç™¼å™¨**: ä¿®å¾©ä¸¦å„ªåŒ–å®šæ™‚ä»»å‹™ç³»çµ±ï¼Œç¢ºä¿ç©©å®šé‹è¡Œ

### ç§»é™¤åŠŸèƒ½
- ç§»é™¤äº†è©³ç´°çš„AIåˆ†æé¡¯ç¤ºï¼ˆå‰ç«¯ï¼‰
- ç°¡åŒ–äº†AIè½å­ç†ç”±ç”Ÿæˆ
- å„ªåŒ–äº†APIç«¯é»ï¼Œç§»é™¤äº†ä¸å¿…è¦çš„åˆ†æåŠŸèƒ½
- ç§»é™¤äº†Text Classificationæ¨¡å‹ï¼Œæ”¹ç”¨æœ¬åœ°ç®—æ³•
- ç§»é™¤äº†è¤‡é›œçš„å­¸ç¿’è…³æœ¬ï¼Œæ¡ç”¨è‡ªç„¶å­¸ç¿’æ–¹å¼

## ğŸŒŸ åŠŸèƒ½äº®é»

### æ™ºèƒ½ AI ç³»çµ±
- **ä¸‰å±¤æ™ºèƒ½æ±ºç­–**: çµåˆå‘é‡è³‡æ–™åº«ã€AIåˆ†æå’Œå‚³çµ±ç®—æ³•çš„æ™ºèƒ½æ±ºç­–ç³»çµ±
- **å‘é‡è³‡æ–™åº«å„ªå…ˆ**: AIå„ªå…ˆæŸ¥è©¢æ­·å²æ£‹è­œè³‡æ–™ï¼Œç²å–ç¶“é©—å»ºè­°
- **AIåˆ†ææŒ‡å°**: AIåˆ†æçµæœç›´æ¥å½±éŸ¿è½å­æ±ºç­–ï¼Œå¯¦ç¾æ™ºèƒ½æ”»å®ˆåˆ¤æ–·
- **å„ªå‹¢åˆ†ææ•´åˆ**: ä½¿ç”¨åŸºæœ¬ç®—æ³•åˆ†æå±€é¢å„ªåŠ£å‹¢ï¼Œæ™ºèƒ½èª¿æ•´æ”»å®ˆç­–ç•¥
- **ç¶œåˆè©•åˆ†ç³»çµ±**: åŸºç¤åˆ†æ•¸ + æ­·å²å»ºè­°åŠ åˆ†(200) + AIåˆ†æåŠ åˆ†(150) + å„ªå‹¢åˆ†æåŠ åˆ†(100-300)
- **å®¹éŒ¯æ©Ÿåˆ¶**: å¤šå±¤é™ç´šç­–ç•¥ï¼Œç¢ºä¿AIå§‹çµ‚èƒ½åšå‡ºåˆç†æ±ºç­–
- **æ€§èƒ½å„ªåŒ–**: åˆ†ç´šè¶…æ™‚æ§åˆ¶ï¼Œç¢ºä¿éŸ¿æ‡‰é€Ÿåº¦
- **å³æ™‚ç‹€æ…‹**: é¡¯ç¤ºAIæ€è€ƒç‹€æ…‹å’Œç”¨æ™‚çµ±è¨ˆ
- **è‡ªæˆ‘è¨“ç·´**: AIå¯é€²è¡Œè‡ªæˆ‘å°æˆ°å­¸ç¿’ï¼ŒæŒçºŒæå‡æ£‹åŠ›
- **æ™ºèƒ½å­¸ç¿’**: è‡ªå‹•è©•ä¼°ç§»å‹•è³ªé‡ï¼Œå­˜å„²é«˜è³ªé‡æ£‹è­œåˆ°å‘é‡è³‡æ–™åº«

### å‘é‡åŒ–æ£‹è­œè³‡æ–™åº«
- **æ™ºèƒ½å‘é‡åŒ–**: å°‡æ£‹ç›¤ç‹€æ…‹è½‰æ›ç‚º 1024 ç¶­å‘é‡
- **å¿«é€Ÿæª¢ç´¢**: åŸºæ–¼é¤˜å¼¦ç›¸ä¼¼åº¦çš„å¿«é€Ÿæª¢ç´¢
- **æ­·å²å»ºè­°**: æä¾›ç›¸ä¼¼å±€é¢çš„æ­·å²æ£‹è­œå»ºè­°
- **æŒçºŒå­¸ç¿’**: æ¯æ¬¡å°å±€éƒ½æœƒæ›´æ–°å‘é‡è³‡æ–™åº«
- **AIæ•´åˆ**: AIæ±ºç­–æ™‚æœƒåƒè€ƒæ­·å²æ£‹è­œè³‡æ–™

### å³æ™‚å¤šäººå°æˆ°
- **Durable Objects**: åŸºæ–¼ Cloudflare çš„åˆ†æ•£å¼æˆ¿é–“ç³»çµ±
- **WebSocket é€šè¨Š**: ä½å»¶é²çš„å³æ™‚é€šè¨Š
- **èŠå¤©åŠŸèƒ½**: æ”¯æ´ç©å®¶é–“å³æ™‚èŠå¤©

### å®Œæ•´ç”¨æˆ¶ç³»çµ±
- **å®‰å…¨èªè­‰**: åŸºæ–¼ D1 è³‡æ–™åº«çš„å®‰å…¨ç”¨æˆ¶èªè­‰
- **ELO è©•åˆ†**: å…¬å¹³çš„æ£‹åŠ›è©•åˆ†ç³»çµ±
- **è©³ç´°çµ±è¨ˆ**: å‹ç‡ã€è©•åˆ†è®ŠåŒ–ã€å°å±€æ™‚é•·ç­‰çµ±è¨ˆ
- **å…¨çƒæ’è¡Œæ¦œ**: å¯¦æ™‚æ›´æ–°çš„å…¨çƒç©å®¶æ’å
- **åŒ¿åæ”¯æ´**: æ”¯æ´åŒ¿åå°æˆ°ï¼Œè‡ªå‹•ç”Ÿæˆç”¨æˆ¶å
- **ç®¡ç†å“¡é…ç½®**: åŸºæ–¼ KV å­˜å„²çš„ç®¡ç†å“¡è¨­å®šå’Œç³»çµ±å¿«å–

### ç¾ä»£åŒ–æŠ€è¡“æ£§
- **ç„¡ä¼ºæœå™¨æ¶æ§‹**: åŸºæ–¼ Cloudflare Workers çš„ç„¡ä¼ºæœå™¨æ¶æ§‹
- **å…¨çƒ CDN**: éœæ…‹è³‡æºå…¨çƒ CDN åŠ é€Ÿ
- **é¡å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript é¡å‹å®šç¾©
- **è‡ªå‹•éƒ¨ç½²**: æ”¯æ´ CI/CD è‡ªå‹•éƒ¨ç½²æµç¨‹

## ğŸ” ç›£æ§å’Œé™¤éŒ¯

### æŸ¥çœ‹æ—¥èªŒ
```bash
wrangler tail
```

### æ€§èƒ½ç›£æ§
- Cloudflare Analytics
- Workers Analytics
- D1 Analytics

### é™¤éŒ¯æŠ€å·§
- ä½¿ç”¨ console.log é€²è¡Œæ—¥èªŒè¨˜éŒ„
- åˆ©ç”¨ Wrangler çš„æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
- æª¢æŸ¥ Cloudflare Dashboard çš„éŒ¯èª¤å ±å‘Š

## ğŸ¤ è²¢ç»æŒ‡å—

æ­¡è¿æäº¤ Pull Request æˆ– Issueï¼

1. Fork å°ˆæ¡ˆ
2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤è®Šæ›´
4. æ¨é€åˆ°åˆ†æ”¯
5. å‰µå»º Pull Request

## ğŸ“„ æˆæ¬Šå”è­°

MIT License

## ğŸ™ è‡´è¬

æ„Ÿè¬ Cloudflare æä¾›å¼·å¤§çš„ç„¡ä¼ºæœå™¨å¹³å°å’Œ AI æœå‹™ï¼Œè®“é€™å€‹å°ˆæ¡ˆæˆç‚ºå¯èƒ½ã€‚

---

ğŸ® **ç¾åœ¨å°±é–‹å§‹æ‚¨çš„äº”å­æ£‹ä¹‹æ—…å§ï¼**